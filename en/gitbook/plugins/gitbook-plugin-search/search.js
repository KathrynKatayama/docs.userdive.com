require(["gitbook","lodash"],function(e,t){function a(e){h=lunr.Index.load(e)}function o(){$.getJSON(e.state.basePath+"/search_index.json").then(a)}function r(e){if(h){var a=t.chain(h.search(e)).map(function(e){var t=e.ref.split("#");return{path:t[0],hash:t[1]}}).value();return a}}function n(t){u&&u.remove(),u=$("<div>",{class:"book-search",role:"search"}),c=$("<input>",{type:"text",class:"form-control",val:t,placeholder:"Type to search"}),c.appendTo(u),u.prependTo(e.state.$book.find(".book-summary"))}function i(){return e.state.$book.hasClass("with-search")}function s(t){i()!==t&&(e.state.$book.toggleClass("with-search",t),i()?(e.sidebar.toggle(!0),c.focus()):(c.blur(),c.val(""),e.sidebar.filter(null)))}function l(){var a=e.storage.get("keyword","");n(a),a.length>0&&(i()||s(),e.sidebar.filter(t.pluck(r(a),"path")))}var c,u,h=null;e.events.bind("start",function(a){o(),n(),$(document).on("keyup",".book-search input",function(a){var o=a.keyCode?a.keyCode:a.which,n=$(this).val();if(27==o)return a.preventDefault(),void s(!1);if(0==n.length)e.sidebar.filter(null),e.storage.remove("keyword");else{var i=r(n);e.sidebar.filter(t.pluck(i,"path")),e.storage.set("keyword",n)}}),e.toolbar.createButton({icon:"fa fa-search",label:"Search",position:"left",onClick:s}),e.keyboard.bind(["f"],s)}),e.events.bind("page.change",l)});